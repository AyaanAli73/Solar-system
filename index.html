<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ayaan Solar: Galaxy</title>
    <style>
        html, body { 
            width: 100%; height: 100%; margin: 0; padding: 0; 
            overflow: hidden; background-color: #000; 
            font-family: 'Courier New', Courier, monospace; 
        }
        
        canvas { display: block; width: 100%; height: 100%; outline: none; }
        
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
        }

        #header { position: absolute; top: 20px; left: 20px; }

        h1 { 
            margin: 0; font-weight: 300; letter-spacing: 5px; 
            text-transform: uppercase; font-size: 20px; 
            color: #fff; text-shadow: 0 0 20px #d000ff;
        }

        #watermark {
            position: absolute; bottom: 10px; right: 20px;
            font-size: 10px; color: rgba(255, 255, 255, 0.5); letter-spacing: 2px;
        }

        /* --- SPEED CONTROLS --- */
        #controls-container {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 5, 20, 0.8);
            border: 1px solid #d000ff;
            padding: 10px 20px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
            pointer-events: auto;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 0 20px rgba(200, 0, 255, 0.2);
        }

        .control-label {
            color: #00ffff; font-size: 12px; font-weight: bold;
            text-shadow: 0 0 5px #00ffff;
            min-width: 80px; text-align: center;
        }

        /* Custom Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 200px;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px; width: 16px;
            border-radius: 50%;
            background: #d000ff;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 10px #d000ff;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        button.speed-btn {
            background: transparent;
            border: 1px solid #00ffff;
            color: #00ffff;
            border-radius: 50%;
            width: 30px; height: 30px;
            cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            font-size: 10px;
            transition: 0.2s;
        }
        button.speed-btn:hover { background: #00ffff; color: #000; }
        
        /* Planet Labels */
        .planet-label {
            position: absolute;
            color: #00ffff;
            font-size: 10px;
            letter-spacing: 1px;
            padding: 2px 5px;
            background: rgba(0, 20, 30, 0.7);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-left: 2px solid #00ffff;
            transform: translate(-50%, -150%);
            white-space: nowrap;
            pointer-events: none;
            text-shadow: 0 0 5px #00ffff;
            display: none; 
        }

        /* Info Card */
        #data-card {
            position: absolute;
            right: -400px; /* Hidden */
            top: 50%;
            transform: translateY(-50%);
            width: 280px;
            background: rgba(15, 5, 25, 0.95);
            border: 1px solid rgba(220, 100, 255, 0.4);
            backdrop-filter: blur(20px);
            padding: 20px;
            color: #fff;
            pointer-events: auto;
            transition: right 0.4s ease-out;
            border-left: 3px solid #d000ff;
            box-shadow: -20px 0 60px rgba(0,0,0,0.9);
        }

        #data-card.active { right: 20px; }

        .card-title {
            font-size: 24px; color: #d000ff;
            text-shadow: 0 0 15px rgba(200, 0, 255, 0.8);
            border-bottom: 1px solid rgba(200, 100, 255, 0.2);
            padding-bottom: 10px; margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .stat-row {
            display: flex; justify-content: space-between;
            margin-bottom: 8px; font-size: 11px; color: #e0aaff;
            border-bottom: 1px dashed rgba(255,255,255,0.1); padding-bottom: 2px;
        }

        .stat-val { color: #fff; font-weight: bold; text-shadow: 0 0 5px #d000ff; }

        .desc-box {
            margin-top: 15px; font-size: 12px; line-height: 1.6;
            color: #ccc; max-height: 100px; overflow-y: auto;
        }

        button.close-btn {
            background: rgba(255, 50, 50, 0.2);
            border: 1px solid #ff3333; color: #ff3333;
            font-size: 10px; cursor: pointer; padding: 4px 8px;
        }
        button.close-btn:hover { background: #ff3333; color: #fff; }

        #loader {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: #030005; display: flex; justify-content: center; align-items: center;
            color: #d000ff; font-size: 18px; letter-spacing: 3px;
            z-index: 100; transition: opacity 1s; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="loader">LOADING ASSETS...</div>

    <div id="ui-layer">
        <div id="header">
            <h1>Solar Orbit</h1>
            <div style="font-size: 9px; color: #aaa;">COSMIC IN MOTION</div>
        </div>

        <div id="labels-container"></div>

        <!-- SPEED CONTROLS -->
        <div id="controls-container">
            <button class="speed-btn" onclick="togglePause()">||</button>
            <input type="range" id="speedSlider" min="0" max="20" step="0.5" value="1" oninput="updateSpeed(this.value)">
            <div class="control-label">SPEED: <span id="speedDisplay">1.0x</span></div>
        </div>

        <div id="data-card">
            <div class="card-title">
                <span id="ui-name">PLANET</span>
                <button class="close-btn" onclick="hideCard()">CLOSE</button>
            </div>
            <div class="stat-row"><span>TYPE</span> <span class="stat-val" id="ui-type">-</span></div>
            <div class="stat-row"><span>TEMP</span> <span class="stat-val" id="ui-temp">-</span></div>
            <div class="stat-row"><span>ORBIT</span> <span class="stat-val" id="ui-orbit">-</span></div>
            <div class="desc-box" id="ui-desc"></div>
        </div>

        <div id="watermark">Created by Ayaan</div>
    </div>

    <!-- Three.js Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <!-- Post Processing -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/FXAAShader.js"></script>

    <script>
        // --- GLOBAL VARIABLES ---
        let speedMultiplier = 1.0;
        let isPaused = false;
        let savedSpeed = 1.0;

        // --- SPEED FUNCTIONS ---
        window.updateSpeed = (val) => {
            speedMultiplier = parseFloat(val);
            document.getElementById('speedDisplay').innerText = speedMultiplier.toFixed(1) + "x";
            if(speedMultiplier > 0) isPaused = false;
        };

        window.togglePause = () => {
            if(isPaused) {
                // Resume
                isPaused = false;
                speedMultiplier = savedSpeed;
                document.getElementById('speedSlider').value = speedMultiplier;
                document.getElementById('speedDisplay').innerText = speedMultiplier.toFixed(1) + "x";
            } else {
                // Pause
                savedSpeed = speedMultiplier > 0 ? speedMultiplier : 1.0;
                speedMultiplier = 0;
                isPaused = true;
                document.getElementById('speedSlider').value = 0;
                document.getElementById('speedDisplay').innerText = "PAUSED";
            }
        };

        // --- 1. SETUP ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050510, 0.00015);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 30000);
        
        const aspect = window.innerWidth / window.innerHeight;
        if (aspect < 1) camera.position.set(0, 350, 650); 
        else camera.position.set(0, 150, 400); 
        camera.lookAt(0,0,0);

        const renderer = new THREE.WebGLRenderer({ antialias: false, powerPreference: "high-performance" });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.0;
        document.body.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 50;
        controls.maxDistance = 8000;

        // --- 2. GALAXY.GLB ---
        const gltfLoader = new THREE.GLTFLoader();
        
        gltfLoader.load(
            'galaxy.glb', 
            function(gltf) {
                const model = gltf.scene;
                model.scale.set(1000, 1000, 1000); 
                model.position.set(0, 0, 0);
                
                model.traverse((child) => {
                    if (child.isMesh) {
                        child.material.side = THREE.BackSide; 
                        child.material.depthWrite = false;
                        child.renderOrder = -10;
                    }
                });

                scene.add(model);
                document.getElementById('loader').style.opacity = 0;
            },
            undefined,
            function(error) {
                console.error('Error', error);
                document.getElementById('loader').innerText = "Load Failed. Check galaxy.glb";
            }
        );

        // --- 3. STARS ---
        const starGeo = new THREE.BufferGeometry();
        const starCount = 2000;
        const starPos = [];
        for(let i=0; i<starCount; i++) {
            const r = 4000 + Math.random() * 4000;
            const theta = Math.random() * Math.PI * 2;
            const phi = Math.acos(2 * Math.random() - 1);
            starPos.push(r * Math.sin(phi) * Math.cos(theta), r * Math.sin(phi) * Math.sin(theta), r * Math.cos(phi));
        }
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
        const starMat = new THREE.PointsMaterial({ color: 0xffffff, size: 2.5, transparent: true, opacity: 0.8, sizeAttenuation: true });
        const stars = new THREE.Points(starGeo, starMat);
        scene.add(stars);

        // --- 4. POST PROCESSING ---
        const renderScene = new THREE.RenderPass(scene, camera);
        const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth/2, window.innerHeight/2), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0.2; 
        bloomPass.strength = 0.5; 
        bloomPass.radius = 0.2;

        const fxaaPass = new THREE.ShaderPass(THREE.FXAAShader);
        const pixelRatio = renderer.getPixelRatio();
        fxaaPass.material.uniforms['resolution'].value.x = 1 / (window.innerWidth * pixelRatio);
        fxaaPass.material.uniforms['resolution'].value.y = 1 / (window.innerHeight * pixelRatio);

        const composer = new THREE.EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);
        composer.addPass(fxaaPass);

        // --- 5. SUN ---
        const sunMat = new THREE.ShaderMaterial({
            uniforms: { uTime: { value: 0 } },
            vertexShader: `varying vec2 vUv; varying vec3 vNormal; void main() { vUv = uv; vNormal = normalize(normalMatrix * normal); gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`,
            fragmentShader: `
                uniform float uTime; varying vec2 vUv; varying vec3 vNormal;
                float hash(vec2 p) { return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453); }
                float noise(vec2 p) { vec2 i = floor(p); vec2 f = fract(p); vec2 u = f * f * (3.0 - 2.0 * f); return mix(mix(hash(i + vec2(0.0, 0.0)), hash(i + vec2(1.0, 0.0)), u.x), mix(hash(i + vec2(0.0, 1.0)), hash(i + vec2(1.0, 1.0)), u.x), u.y); }
                void main() {
                    float n = noise(vUv * 8.0 + uTime * 0.5);
                    vec3 color = mix(vec3(1.0, 0.3, 0.0), vec3(1.0, 0.8, 0.5), n);
                    float fresnel = pow(0.7 - dot(vNormal, vec3(0,0,1)), 2.0);
                    gl_FragColor = vec4(color + fresnel*vec3(1.0,0.5,0.0), 1.0);
                }
            `
        });
        const sun = new THREE.Mesh(new THREE.SphereGeometry(15, 48, 48), sunMat);
        sun.userData = { name: "THE SUN", type: "G-Type Star", temp: "5,778 K", orbit: "N/A", desc: "The star at the center of our Solar System." };
        scene.add(sun);
        scene.add(new THREE.PointLight(0xffffff, 2.0, 1000));
        scene.add(new THREE.AmbientLight(0x404060));

        // --- 6. COMETS ---
        class Comet {
            constructor() {
                const geo = new THREE.SphereGeometry(0.8, 8, 8);
                const mat = new THREE.MeshBasicMaterial({ color: 0x88ffff });
                this.mesh = new THREE.Mesh(geo, mat);
                const tailGeo = new THREE.BufferGeometry();
                const tailCount = 30;
                this.tailPos = new Float32Array(tailCount * 3);
                tailGeo.setAttribute('position', new THREE.BufferAttribute(this.tailPos, 3));
                const tailMat = new THREE.PointsMaterial({
                    color: 0xff88ff, size: 3, transparent: true, opacity: 0.6, blending: THREE.AdditiveBlending
                });
                this.tail = new THREE.Points(tailGeo, tailMat);
                scene.add(this.mesh);
                scene.add(this.tail);
                this.reset();
            }
            reset() {
                this.angle = Math.random() * Math.PI * 2;
                this.distance = 250 + Math.random() * 150;
                this.speed = 0.2 + Math.random() * 0.3;
                this.eccentricity = 0.6;
                this.history = [];
            }
            update(dt) {
                // Comets also affected by speedMultiplier
                this.angle += this.speed * speedMultiplier * dt;
                const x = Math.cos(this.angle) * this.distance;
                const z = Math.sin(this.angle) * (this.distance * this.eccentricity);
                const y = Math.sin(this.angle * 3) * 30; 
                this.mesh.position.set(x, y, z);
                this.history.unshift(new THREE.Vector3(x, y, z));
                if(this.history.length > 30) this.history.pop();
                const posAttr = this.tail.geometry.attributes.position;
                for(let i=0; i<this.history.length; i++) posAttr.setXYZ(i, this.history[i].x, this.history[i].y, this.history[i].z);
                posAttr.needsUpdate = true;
            }
        }
        const comets = [new Comet(), new Comet(), new Comet()];

        // --- 7. ASTEROID BELT ---
        const asteroidGeo = new THREE.DodecahedronGeometry(0.6, 0);
        const asteroidMat = new THREE.MeshStandardMaterial({ color: 0xaa99cc, roughness: 0.6 }); 
        const asteroidBelt = new THREE.InstancedMesh(asteroidGeo, asteroidMat, 1500);
        const dummy = new THREE.Object3D();
        for(let i=0; i<1500; i++) {
            const angle = Math.random() * Math.PI * 2;
            const r = 110 + (Math.random() - 0.5) * 18;
            dummy.position.set(Math.cos(angle)*r, (Math.random()-0.5)*8, Math.sin(angle)*r);
            dummy.rotation.set(Math.random()*3, Math.random()*3, Math.random()*3);
            dummy.scale.setScalar(Math.random()*2 + 0.5);
            dummy.updateMatrix();
            asteroidBelt.setMatrixAt(i, dummy.matrix);
        }
        scene.add(asteroidBelt);

        // --- 8. PLANETS ---
        const interactables = [];
        const planets = [];
        const labelsContainer = document.getElementById('labels-container');

        function createPlanet(data) {
            const group = new THREE.Object3D();
            scene.add(group);

            const canvas = document.createElement('canvas');
            canvas.width = 256; canvas.height = 256;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = data.color; ctx.fillRect(0,0,256,256);
            ctx.fillStyle = "rgba(255,255,255,0.1)";
            for(let i=0; i<30; i++) ctx.fillRect(Math.random()*256, Math.random()*256, 10, 2); 
            
            const mesh = new THREE.Mesh(
                new THREE.SphereGeometry(data.size, 32, 32),
                new THREE.MeshStandardMaterial({ map: new THREE.CanvasTexture(canvas), roughness: 0.7 })
            );
            mesh.position.x = data.dist;
            group.add(mesh);

            if(data.ring) {
                const ring = new THREE.Mesh(
                    new THREE.RingGeometry(data.size*1.4, data.size*2.2, 48),
                    new THREE.MeshStandardMaterial({ color: 0xccaa88, side: THREE.DoubleSide, transparent:true, opacity:0.6 })
                );
                ring.rotation.x = Math.PI/2.2;
                mesh.add(ring);
            }

            const path = new THREE.Mesh(
                new THREE.RingGeometry(data.dist-0.1, data.dist+0.1, 64),
                new THREE.MeshBasicMaterial({ color: 0x8866aa, side: THREE.DoubleSide, transparent:true, opacity:0.1 })
            );
            path.rotation.x = Math.PI/2;
            scene.add(path);

            const label = document.createElement('div');
            label.className = 'planet-label';
            label.innerText = data.name;
            labelsContainer.appendChild(label);

            mesh.userData = data;
            interactables.push(mesh);
            planets.push({ mesh, group, speed: data.speed, selfRot: Math.random()*0.02, label });
        }

        const pData = [
            { name: "MERCURY", size: 2, dist: 35, speed: 0.04, color: "#999", type: "Terrestrial", temp: "440 K", orbit: "88 Days", desc: "Closest planet to the Sun." },
            { name: "VENUS", size: 3.5, dist: 50, speed: 0.02, color: "#e3bb76", type: "Terrestrial", temp: "737 K", orbit: "225 Days", desc: "Thick, toxic atmosphere." },
            { name: "EARTH", size: 3.8, dist: 70, speed: 0.015, color: "#2233ff", type: "Terrestrial", temp: "288 K", orbit: "365 Days", desc: "Supports life." },
            { name: "MARS", size: 2.8, dist: 90, speed: 0.012, color: "#cc4422", type: "Terrestrial", temp: "210 K", orbit: "687 Days", desc: "The Red Planet." },
            { name: "CERES", size: 0.8, dist: 115, speed: 0.007, color: "#777", type: "Dwarf Planet", temp: "168 K", orbit: "4.6 Yrs", desc: "Largest asteroid." },
            { name: "JUPITER", size: 10, dist: 140, speed: 0.005, color: "#d4a34b", type: "Gas Giant", temp: "165 K", orbit: "12 Yrs", desc: "Massive gas giant." },
            { name: "SATURN", size: 9, dist: 180, speed: 0.003, color: "#f4d47c", ring: true, type: "Gas Giant", temp: "134 K", orbit: "29 Yrs", desc: "Known for rings." },
            { name: "URANUS", size: 6, dist: 220, speed: 0.002, color: "#7ce4f4", type: "Ice Giant", temp: "76 K", orbit: "84 Yrs", desc: "Rotates on side." },
            { name: "NEPTUNE", size: 6, dist: 260, speed: 0.001, color: "#3c44f4", type: "Ice Giant", temp: "72 K", orbit: "165 Yrs", desc: "Windy and cold." },
            { name: "PLUTO", size: 1.5, dist: 320, speed: 0.0008, color: "#c2b2a3", type: "Dwarf Planet", temp: "44 K", orbit: "248 Yrs", desc: "Kuiper belt object." }
        ];
        pData.forEach(createPlanet);
        interactables.push(sun);

        // --- 9. INTERACTION ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        window.addEventListener('touchstart', (e) => {
             if(e.touches.length === 1) {
                 const t = e.touches[0];
                 mouse.x = (t.clientX / window.innerWidth) * 2 - 1;
                 mouse.y = -(t.clientY / window.innerHeight) * 2 + 1;
                 checkIntersection();
             }
        }, {passive: false});

        window.addEventListener('mousedown', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            checkIntersection();
        });

        function checkIntersection() {
            raycaster.setFromCamera(mouse, camera);
            const hits = raycaster.intersectObjects(interactables);
            if(hits.length > 0) showData(hits[0].object.userData);
        }

        function showData(data) {
            document.getElementById('ui-name').innerText = data.name;
            document.getElementById('ui-type').innerText = data.type;
            document.getElementById('ui-temp').innerText = data.temp;
            document.getElementById('ui-orbit').innerText = data.orbit;
            document.getElementById('ui-desc').innerText = data.desc;
            document.getElementById('data-card').classList.add('active');
        }

        window.hideCard = () => document.getElementById('data-card').classList.remove('active');

        // --- 10. LOOP ---
        const clock = new THREE.Clock();
        const tempV = new THREE.Vector3();

        function animate() {
            requestAnimationFrame(animate);
            const t = clock.getElapsedTime();
            const dt = clock.getDelta();
            
            sunMat.uniforms.uTime.value = t;
            asteroidBelt.rotation.y += 0.001 * speedMultiplier;
            comets.forEach(c => c.update(dt));

            planets.forEach(p => {
                // APPLY SPEED MULTIPLIER HERE
                p.group.rotation.y += p.speed * speedMultiplier;
                p.mesh.rotation.y += p.selfRot * (1 + speedMultiplier/2);

                p.mesh.getWorldPosition(tempV);
                tempV.project(camera);
                if (tempV.z < 1 && tempV.x > -1 && tempV.x < 1 && tempV.y > -1 && tempV.y < 1) {
                     p.label.style.display = 'block';
                     p.label.style.left = `${(tempV.x*.5+.5)*window.innerWidth}px`;
                     p.label.style.top = `${(tempV.y*-.5+.5)*window.innerHeight}px`;
                } else {
                     p.label.style.display = 'none';
                }
            });

            controls.update();
            composer.render();
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            composer.setSize(window.innerWidth, window.innerHeight);
            const pr = renderer.getPixelRatio();
            fxaaPass.material.uniforms['resolution'].value.x = 1 / (window.innerWidth * pr);
            fxaaPass.material.uniforms['resolution'].value.y = 1 / (window.innerHeight * pr);
        });

        animate();
    </script>
</body>
</html>

